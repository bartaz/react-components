import { ArgsTable, Canvas, Meta, Story } from "@storybook/addon-docs/blocks";
import { useState } from "react";

import CodeSnippet, { CodeSnippetBlock, CodeSnippetDropdown } from "./CodeSnippet";

<Meta
  title="CodeSnippet"
  component={CodeSnippet}
  argTypes={{
    className: {
      control: {
        type: "text",
      },
    },
  }}
/>

### Code snippet

This is a [React](https://reactjs.org/) component for the Vanilla [Code snippet](https://docs.vanillaframework.io/base/code#code-snippet).

### Props

<ArgsTable of={CodeSnippet} />

#### Blocks

Single `CodeSnippet` component can render multiple separate code blocks. Blocks are provided as an array via the `blocks` prop. Each block object defines values of props for each code block of the snippet:

<ArgsTable of={CodeSnippetBlock} />

### Default

<Canvas>
  <Story name="Default">
    <CodeSnippet blocks={[ {code: "Mode: all Settings: maas_url=http://192.168.122.1:5240/MAAS"} ]} />
  </Story>
</Canvas>

### Title

<Canvas>
  <Story name="Title">
    <CodeSnippet blocks={[ { title: "Output", code: "Mode: all Settings: maas_url=http://192.168.122.1:5240/MAAS"} ]} />
  </Story>
</Canvas>

### Multiple blocks

<Canvas>
  <Story name="Multiple blocks">
    <CodeSnippet blocks={[
      { title: "JavaScript", code: "console.log('Vanilla');"},
      { title: "Output", code: "Vanilla" },
    ]} />
  </Story>
</Canvas>


### Icon / Prompt

<Canvas>
  <Story name="Icon">
    <CodeSnippet blocks={[
       { title: "Install on Linux", appearance: "linuxPrompt", code: "snap install toto"},
       { title: "Install on Windows", appearance: "windowsPrompt", code: "snap install toto"},
       { title: "Get from the Store", appearance: "url", code: "http://snapcraft.io/toto"} ,
     ]}/>
  </Story>
</Canvas>

### Numbered

<Canvas>
  <Story name="Numbered">
    <CodeSnippet blocks={[
       { appearance: "numbered",
         code: `#!/bin/bash
set -eu . $CONJURE_UP_SPELLSDIR/sdk/common.sh
if [[ "$JUJU_PROVIDERTYPE" == "lxd" ]]; then
  debug "Running pre-deploy for $CONJURE_UP_SPELL"
  sed "s/##MODEL##/$JUJU_MODEL/" $(scriptPath)/lxd-profile.yaml | lxc profile edit "juju-$JUJU_MODEL" || exposeResult "Failed to set profile" $? "false"
fi
exposeResult "Successful pre-deploy." 0 "true"`
       },
     ]}/>
  </Story>
</Canvas>

### Wrap lines

<Canvas>
  <Story name="Wrap lines">
    <CodeSnippet blocks={[
       { numbered: true,
         wrapLines: true,
         code: `#!/bin/bash
set -eu . $CONJURE_UP_SPELLSDIR/sdk/common.sh
if [[ "$JUJU_PROVIDERTYPE" == "lxd" ]]; then
  debug "Running pre-deploy for $CONJURE_UP_SPELL"
  sed "s/##MODEL##/$JUJU_MODEL/" $(scriptPath)/lxd-profile.yaml | lxc profile edit "juju-$JUJU_MODEL" || exposeResult "Failed to set profile" $? "false"
fi
exposeResult "Successful pre-deploy." 0 "true"`
       },
     ]}/>
  </Story>
</Canvas>

### Dropdowns

Dropdown select menus can be added to the headers of code blocks to allow users to choose one of the options. The dropdowns options are passed via `dropdowns` property in the block options object.

Dropdown configuration object is structured as follows:
<ArgsTable of={CodeSnippetDropdown} />

With the `options` being an array of option properties compatible with the `Select` options (`[{ label: string, value: string | number }]`).

<Canvas>
  <Story name="Dropdowns">
  {() => {
    const [lang, setLang] = useState("html");
    const code = {
      js: `console.log("Example 1");`,
      css: `.p-heading--two { color: red; }`,
      html: `<h1 class="p-heading--two">How to use code snippets</h1>`,
    };
    return <CodeSnippet blocks={[
       {
         code: code[lang],
         dropdowns: [
           { options: [
              { value: "js", label: "JS" },
              { value: "css", label: "CSS" },
              { value: "html", label: "HTML", selected: true },
            ],
            onChange: (event) => { setLang(event.target.value) }
           }
         ]
       },
     ]} />;
  }}
  </Story>
</Canvas>

